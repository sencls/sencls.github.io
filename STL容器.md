# STL å®¹å™¨

> æœ¬æ–‡ä»¶æ•´ç†äº† `STL.cpp` ä¸­çš„æ³¨é‡Šå†…å®¹

---

## ç›®å½•

- [listï¼ˆåŒç«¯é“¾è¡¨ï¼‰](#liståŒç«¯é“¾è¡¨)
- [dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰](#dequeåŒç«¯é˜Ÿåˆ—)
- [mapï¼ˆå…³è”å®¹å™¨ï¼‰](#mapå…³è”å®¹å™¨)
- [unordered_mapï¼ˆæ— åºæ˜ å°„ï¼‰](#unordered_mapæ— åºæ˜ å°„)

---

## listï¼ˆåŒç«¯é“¾è¡¨ï¼‰

### åŸºæœ¬æ“ä½œ

```cpp
List<int> l;

// æ·»åŠ å…ƒç´ 
l.push_back(22);         // å°¾éƒ¨æ·»åŠ 
l.push_front(11);        // å‰å‘æ·»åŠ 
l.insert(--l.end(), 12); // åœ¨è¿­ä»£å™¨å‰é¢æ·»åŠ ï¼Œè¿”å›å€¼æ˜¯æ·»åŠ å…ƒç´ æ‰€åœ¨çš„è¿­ä»£å™¨

// åˆ é™¤å…ƒç´ 
l.remove(2);             // éå†å…¨éƒ¨ï¼Œåˆ é™¤æ‰€æœ‰ç­‰å€¼å…ƒç´ 
l.erase(--l.end());      // åˆ é™¤è¿­ä»£å™¨æ‰€æŒ‡ä½ç½®ï¼Œå¹¶è¿”å›åˆ é™¤åè¿­ä»£å™¨æ‰€æŒ‡
l.pop_back();            // åˆ é™¤å°¾éƒ¨
l.pop_front();           // åˆ é™¤å¤´éƒ¨

// è®¿é—®å…ƒç´ 
int a = l.front();       // å–å¤´éƒ¨å…ƒç´ 
int b = l.back();        // å–å°¾éƒ¨å…ƒç´ 
```

### æ—¶é—´å¤æ‚åº¦

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ |
|:---|:---|
| æ’å…¥/åˆ é™¤ï¼ˆé¦–å°¾ï¼‰ | O(1) |
| éšæœºè®¿é—® | O(n) |

---

## dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰

æ”¯æŒå‰ç«¯åç«¯ä»¥ **Î˜(1)** è¿›è¡Œæ’å…¥ä¸åˆ é™¤ï¼Œè®¿é—®å¸¸æ•°æ—¶é—´ï¼Œä½†ä¸­é—´æ’å…¥æ˜¯ **Î˜(n)**

### å†…éƒ¨åŸç†

ç”±å¤§å°å›ºå®šçš„æ•°ç»„å—ç»„æˆï¼Œè¿™äº›å—é€šè¿‡ä¸€ä¸ªä¸­å¤®æ˜ å°„æ•°ç»„ç®¡ç†ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Central Map (map)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ptr â”‚ â”‚ ptr â”‚ â”‚ ptr â”‚ â”‚ ptr â”‚ ...  â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜      â”‚
â”‚     â”‚      â”‚      â”‚      â”‚            â”‚
â”‚  â”Œâ”€â”€â–¼â”€â”€â” â”Œâ–¼â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”        â”‚
â”‚  â”‚chunkâ”‚ â”‚chunkâ”‚ â”‚chunkâ”‚ â”‚chunkâ”‚ ...  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. **ä¸­å¤®æ˜ å°„æ•°ç»„ (map)**ï¼šæŒ‡é’ˆæ•°ç»„ï¼ŒæŒ‡å‘å„æ•°ç»„å—ï¼Œæœ¬èº«ä¹Ÿæ˜¯åŠ¨æ€åˆ†é…ï¼Œå¯ä»¥åœ¨ä¸¤ç«¯æ·»åŠ æ–°çš„æ•°æ®å—
2. **æ•°æ®å— (chunk)**ï¼šæœ¬èº«æ˜¯å›ºå®šå¤§å°è¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œå¤§å°é€šå¸¸ä¸å¹³å°å’Œç¼–è¯‘å™¨æœ‰å…³
3. **èµ·å§‹ä¸ç»“æŸæŒ‡é’ˆ**ï¼šç»´æŠ¤æŒ‡å‘ map çš„ç¬¬ä¸€ä¸ªæœ‰æ•ˆæ•°æ®å—ä¸ç¬¬ä¸€ä¸ªæ— æ•ˆæ•°æ®å—ï¼Œä»¥æ­¤æ¥è¾¾åˆ°åŒç«¯çš„å¢å‡

### åŸºæœ¬æ“ä½œ

```cpp
#include <deque>

std::deque<std::string> dq;

// æ·»åŠ å…ƒç´ 
dq.push_back("hello");  // åæ’
dq.push_back("back");
dq.push_front("c++");   // å‰æ’
dq.push_front("Java");

// åˆ é™¤å…ƒç´ 
dq.pop_front();         // å‰åˆ 
dq.pop_back();          // ååˆ 

// è®¿é—®å…ƒç´ 
std::string a = dq.front();
std::string b = dq.back();
```

---

## mapï¼ˆå…³è”å®¹å™¨ï¼‰

å­˜å‚¨é”®å€¼å¯¹ï¼Œ**é”®æ˜¯å”¯ä¸€çš„**ï¼Œå¹¶æŒ‰ç‰¹å®šé¡ºåºï¼ˆé€šå¸¸æ˜¯å‡åºï¼‰è‡ªåŠ¨æ’åºï¼Œå¸¸åŸºäº**çº¢é»‘æ ‘**å®ç°ã€‚

### ç‰¹ç‚¹

| ç‰¹ç‚¹ | è¯´æ˜ |
|:---|:---|
| **å†…å®¹æœ‰åº** | è‡ªåŠ¨æŒ‰é”®æ’åº |
| **é”®å”¯ä¸€** | é‡å¤æ’å…¥ä¸ä¼šæ“ä½œ |
| **é«˜æ•ˆæŸ¥è¯¢** | é€šè¿‡é”®æŸ¥è¯¢ O(log n) |
| **åŠ¨æ€æ“ä½œ** | æ”¯æŒåŠ¨æ€æ’å…¥å’Œåˆ é™¤ |

### åŸºæœ¬æ“ä½œ

```cpp
#include <map>
#include <string>

// åˆå§‹åŒ–
std::map<int, std::string> mymap = {{1, "www"}, {3, "qqqq"}, {2, "eeee"}};

// æ’å…¥å…ƒç´ 
mymap.insert(std::pair<int, std::string>(12, "hello"));
mymap.insert(std::make_pair(5, "for"));
mymap.insert({23, "alal"});
mymap.insert({23, "al"});  // é‡å¤æ’å…¥ï¼Œä¸ä¼šå¤å†™ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä½†ä¸æ“ä½œ

// ä¿®æ”¹/æ·»åŠ å…ƒç´ 
mymap[12] = "aaaa";   // å¯ä»¥ä¿®æ”¹å·²å­˜åœ¨çš„é”®
mymap[24] = "qwe";    // æ²¡æœ‰å¯¹åº”çš„é”®å°±æ·»åŠ 

// è®¿é—®å…ƒç´ 
auto f = mymap[12];   // ä¸å­˜åœ¨çš„è¯ï¼Œä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ª null å€¼çš„é”®å¯¹
// auto r = mymap.at(11);  // å®‰å…¨è®¿é—®ï¼Œæ²¡æœ‰ä¼šæŠ›å‡ºå¼‚å¸¸

// æŸ¥æ‰¾å…ƒç´ 
auto t = mymap.find(3);  // åˆ©ç”¨é”®æœç´¢ï¼Œè¿”å›è¿­ä»£å™¨
if (t != mymap.end())
    std::cout << t->second << std::endl;

// åˆ é™¤å…ƒç´ 
mymap.erase(mymap.begin(), mymap.find(12));  // å¯ä»¥ä¼ è¿­ä»£å™¨æˆ–è€…é”®å€¼ï¼Œä¸¤ä¸ªå‚æ•°(è¿­ä»£å™¨)æ—¶åˆ é™¤ç¬¦åˆå‚æ•°èŒƒå›´å·¦é—­å³å¼€åŒºé—´

// å…¶ä»–æ“ä½œ
std::cout << mymap.size() << std::endl;
mymap.count(1);                   // è¿”å›å½“å‰é”®å€¼çš„å‡ºç°æ¬¡æ•°ï¼›
auto p = mymap.lower_bound(12);   // è¿”å›ç¬¬ä¸€ä¸ªä¸å°äºè¯¥é”®å€¼çš„è¿­ä»£å™¨
auto s = mymap.upper_bound(24);   // è¿”å›ç¬¬ä¸€ä¸ªå¤§äºçš„è¿­ä»£å™¨
```

### éå†æ–¹å¼

#### èŒƒå›´ for å¾ªç¯

```cpp
for (const auto &t : mymap) {
    std::cout << t.first << ' ' << t.second << std::endl;
}
```

#### æ³›å‹å‡½æ•°ï¼ˆfor_eachï¼‰

```cpp
for_each(p, s, [](auto pair) -> void {
    std::cout << pair.first << " " << pair.second << ' ';
});
```

#### transform

```cpp
std::map<int, std::string> test;
std::transform(p, s, std::inserter(test, test.end()), [](auto &pair) -> auto {
    auto new_p = pair.second;
    std::transform(new_p.begin(), new_p.end(), new_p.begin(), ::toupper);
    return std::make_pair(pair.first, new_p);
});

for (const auto &t : test) {
    std::cout << t.first << ' ' << t.second << std::endl;
}
```

### è‡ªå®šä¹‰é”®ç±»å‹

å½“é”®æ˜¯è‡ªå®šä¹‰ç±»å‹æ—¶ï¼Œéœ€è¦æä¾›æ¯”è¾ƒå‡½æ•°ã€‚

#### æ–¹å¼1ï¼šç±»é‡è½½ <

```cpp
class M {
    bool operator<(const M& other) const {
        return this->__ > other.__;
    }
};

std::map<M, std::string> mymap;
```

#### æ–¹å¼2ï¼šæä¾›å¯è°ƒç”¨å¯¹è±¡

```cpp
struct comp {
    bool operator()(const type& a, const type& b) const {
        return a.__ > b.__;
    }
};

std::map<type, type, comp> mymap;
```

#### æ–¹å¼3ï¼šä½¿ç”¨ function

```cpp
std::function<bool(type a, type b)> comp = [](type a, type b) -> bool {
    return a < b;
};

std::map<type, other_type, std::function<bool(type a, type b)>> a(comp);

// æˆ–ä½¿ç”¨ decltype
// e.g. std::map<Person, std::string, decltype(comp)> qw(comp);
```

---

## unordered_mapï¼ˆæ— åºæ˜ å°„ï¼‰

æ— åºåˆ—è¡¨ï¼Œ**å¸¸æ•°æ—¶é—´**çš„æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ï¼Œä½†ä¸ä¿è¯é¡ºåºã€‚

### åŸºæœ¬æ¨¡æ¿å®šä¹‰

```cpp
#include <unordered_map>

std::unordered_map<
    KeyType,                    // é”®ç±»å‹
    ValueType,                  // å€¼ç±»å‹
    Hash = std::hash<KeyType>,  // å“ˆå¸Œå‡½æ•°
    KeyEqual = std::equal_to<KeyType>,  // é”®å€¼ç›¸ç­‰åˆ¤æ–­
    Allocator = std::allocator<std::pair<const KeyType, ValueType>>  // å†…å­˜åˆ†é…å™¨
>
```

| å‚æ•° | è¯´æ˜ |
|:---|:---|
| **Hash** | å“ˆå¸Œå‡½æ•° |
| **KeyEqual** | é”®å€¼ç›¸ç­‰æ—¶ |
| **Allocator** | å†…å­˜åˆ†é…å™¨ |

### åŸºæœ¬æ“ä½œ

```cpp
// é€šè¿‡ [] è®¿é—® map ä¸­ï¼Œæ²¡æœ‰çš„å¯¹è±¡è‡ªåŠ¨æ„å»ºå¯¹è±¡ï¼Œç„¶åç»™é»˜è®¤å€¼
// insert() æ’å…¥å‡½æ•° insert({}), emplace(key, value)
// erase()ï¼Œæ ¹æ®å‚æ•°å†…å®¹è¿”å›å¯¹è±¡ï¼Œè¿­ä»£å™¨->åˆ é™¤åæ‰€æŒ‡çš„è¿­ä»£å™¨ï¼Œé”®->å€¼
// bucket_count() è¿”å›æ¡¶æ•°é‡
// rehash() è°ƒæ•´æ¡¶æ•°é‡
```

### è‡ªå®šä¹‰é”®ç±»å‹

ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ä½œä¸ºé”®æ—¶ï¼Œéœ€è¦å®šä¹‰ï¼š

1. **æ¯”è¾ƒå‡½æ•°**
2. **å“ˆå¸Œå‡½æ•°**

---

## å®¹å™¨å¯¹æ¯”

| å®¹å™¨ | æŸ¥æ‰¾ | æ’å…¥/åˆ é™¤ | éšæœºè®¿é—® | æ˜¯å¦æœ‰åº |
|:---|:---:|:---:|:---:|:---:|
| **list** | O(n) | O(1) é¦–å°¾ | O(n) | âŒ |
| **deque** | O(n) | O(1) é¦–å°¾ | O(1) | âŒ |
| **map** | O(log n) | O(log n) | O(log n) | âœ… å‡åº |
| **unordered_map** | O(1) å¹³å‡ | O(1) å¹³å‡ | O(1) å¹³å‡ | âŒ |

---

> æ•´ç†è€…ï¼šè•¾å§† ğŸ’™
