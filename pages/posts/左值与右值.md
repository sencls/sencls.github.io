---
title: C++ å·¦å€¼ä¸å³å€¼
date: 2026-02-12
updated: 2026-02-12
categories: C++
tags:
  - C++
  - å·¦å€¼
  - å³å€¼
  - å®Œç¾è½¬å‘
---

# å·¦å€¼ä¸å³å€¼

> æœ¬æ–‡ä»¶æ•´ç†äº† `lv_rv.cpp` ä¸­çš„æ³¨é‡Šå†…å®¹

---

## ç›®å½•

- [å®šä¹‰](#å®šä¹‰)
- [C++11 ç»†åˆ†](#c11-ç»†åˆ†)
- [ç±»å‹åˆ¤æ–­](#ç±»å‹åˆ¤æ–­)
- [æ¨¡æ¿ä¸‡èƒ½å¼•ç”¨ï¼ˆè½¬å‘å¼•ç”¨ï¼‰](#æ¨¡æ¿ä¸‡èƒ½å¼•ç”¨è½¬å‘å¼•ç”¨)
- [å¼•ç”¨æŠ˜å è§„åˆ™](#å¼•ç”¨æŠ˜å è§„åˆ™)
- [std::forward å®Œç¾è½¬å‘](#stdforward-å®Œç¾è½¬å‘)
- [ç±»å‹æ¨å¯¼è§„åˆ™](#ç±»å‹æ¨å¯¼è§„åˆ™)
- [åŸæ ·è½¬å‘](#åŸæ ·è½¬å‘)

---

## å®šä¹‰

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|:---|:---|:---|
| **lvalue (å·¦å€¼)** | å…·æœ‰æŒä¹…å­˜å‚¨çš„å¯¹è±¡ï¼Œå¯å‡ºç°åœ¨èµ‹å€¼è¯­å¥å·¦ä¾§ï¼Œå¯è¢«å–åœ°å€ | å˜é‡åã€å¼•ç”¨ |
| **rvalue (å³å€¼)** | ä¸´æ—¶å¯¹è±¡æˆ–æ²¡æœ‰æŒä¹…å­˜å‚¨çš„å€¼ï¼Œé€šå¸¸å‡ºç°åœ¨èµ‹å€¼è¯­å¥å³ä¾§ï¼Œä¸èƒ½è¢«å–åœ°å€ | å­—é¢é‡ã€ä¸´æ—¶å¯¹è±¡ã€è¡¨è¾¾å¼ç»“æœ |

### åŸºæœ¬ç¤ºä¾‹

```cpp
int a = 10;
//  ^    ^
//  å·¦å€¼  å³å€¼

int b = a;      // a æ˜¯å·¦å€¼ï¼Œä½†ä½œä¸ºè¡¨è¾¾å¼ç»“æœæ—¶æ˜¯å³å€¼
int c = a + b;  // a + b çš„ç»“æœæ˜¯å³å€¼
```

---

## C++11 ç»†åˆ†

åœ¨ C++11 ä¸­ï¼Œå³å€¼è¢«è¿›ä¸€æ­¥ç»†åˆ†ä¸ºï¼š

### åˆ†ç±»

| ç±»å‹ | è‹±æ–‡ | è¯´æ˜ | ç¤ºä¾‹ |
|:---|:---|:---|:---|
| **çº¯å³å€¼** | prvalue | ä¸´æ—¶å¯¹è±¡ã€å­—é¢é‡ | `10`, `3.14`, `"hello"` |
| **å°†äº¡å€¼** | xvalue | è¡¨ç¤ºå³å°†è¢«ç§»åŠ¨çš„å¯¹è±¡ | `std::move()` çš„ç»“æœ |

### ä»·å€¼ç±»åˆ«

```
         è¡¨è¾¾å¼
           |
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    |             |
  å·¦å€¼         å³å€¼
 (lvalue)     (rvalue)
    |        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    |        |         |
   å·¦å€¼     çº¯å³å€¼    å°†äº¡å€¼
          (prvalue) (xvalue)
```

---

## ç±»å‹åˆ¤æ–­

### åˆ¤æ–­å‡½æ•°

```cpp
#include <type_traits>

std::is_lvalue_reference<decltype()>::value  // åˆ¤æ–­æ˜¯å¦æ˜¯å·¦å€¼å¼•ç”¨
std::is_lvalue_reference_v<decltype()>        // ç®€å†™ç‰ˆæœ¬ (C++17)

std::is_rvalue_reference<decltype()>::value  // åˆ¤æ–­æ˜¯å¦æ˜¯å³å€¼å¼•ç”¨
std::is_rvalue_reference_v<decltype()>        // ç®€å†™ç‰ˆæœ¬ (C++17)
```

### é‡è¦ï¼šåˆ¤æ–­å·¦å€¼æ—¶çš„ decltype

```cpp
// åˆ¤æ–­å·¦å€¼æ—¶ï¼Œéœ€è¦ä½¿ç”¨ä¸¤å±‚æ‹¬å·
int a = 10;
std::is_lvalue_reference_v<decltype((a))>  // true
std::is_lvalue_reference_v<decltype(a)>    // false

int &b = a;
std::is_lvalue_reference_v<decltype(b)>    // true
```

### å®Œæ•´ç¤ºä¾‹

```cpp
int a = 10;
int &b = a;
int &&c = std::move(a);

// åˆ¤æ–­ç±»å‹
std::cout << std::is_lvalue_reference_v<decltype((a))> << std::endl;  // true
std::cout << std::is_lvalue_reference_v<decltype(b)> << std::endl;    // true
std::cout << std::is_rvalue_reference_v<decltype(c)> << std::endl;    // true
```

---

## æ¨¡æ¿ä¸‡èƒ½å¼•ç”¨ï¼ˆè½¬å‘å¼•ç”¨ï¼‰

### æ¦‚å¿µ

**ä¸‡èƒ½å¼•ç”¨**ï¼ˆUniversal Referenceï¼‰æˆ– **è½¬å‘å¼•ç”¨**ï¼ˆForwarding Referenceï¼‰æ˜¯ C++11 å¼•å…¥çš„å¼•ç”¨ç±»å‹ã€‚

### ç‰¹ç‚¹

1. **è¡¨ç°å½¢å¼ä¸º `T&&`**ï¼šT æ˜¯æ¨¡æ¿å‚æ•°
2. **ç¼–è¯‘å™¨è‡ªåŠ¨æ¨å¯¼**ï¼šè§£æä¸ºå·¦å€¼å¼•ç”¨è¿˜æ˜¯å³å€¼å¼•ç”¨
3. **ç»Ÿä¸€å¤„ç†**ï¼šèƒ½ç»Ÿä¸€å¤„ç†å·¦å€¼ä¸å³å€¼

### æ¨å¯¼è§„åˆ™

| T çš„æ¨å¯¼ç»“æœ | å¼•ç”¨ç±»å‹ |
|:---|:---|
| æ™®é€šç±»å‹ | å³å€¼å¼•ç”¨ |
| å¼•ç”¨ç±»å‹ | å·¦å€¼å¼•ç”¨ |

### ç¤ºä¾‹

```cpp
template <typename T>
void fun1(T &&x) {
    std::cout << "T is lv reference: " << std::is_lvalue_reference_v<T> << std::endl;
    std::cout << "T is rv reference: " << std::is_rvalue_reference_v<T> << std::endl;
    std::cout << "x is lv reference: " << std::is_lvalue_reference_v<decltype(x)> << std::endl;
    std::cout << "x is rv reference: " << std::is_rvalue_reference_v<decltype(x)> << std::endl;
}

int a = 10;
fun1(a);              // T æ¨å¯¼ä¸º int&ï¼Œx ä¸º int&
fun1(std::move(a));   // T æ¨å¯¼ä¸º intï¼Œx ä¸º int&&
```

---

## å¼•ç”¨æŠ˜å è§„åˆ™

å¤„ç†å¼•ç”¨ç±»å‹çš„åµŒå¥—ã€‚

### è§„åˆ™

| ç»„åˆ | ç»“æœ | è¯´æ˜ |
|:---|:---:|:---|
| `& &` | `&` | å·¦å€¼å¼•ç”¨ |
| `&& &` | `&` | å·¦å€¼å¼•ç”¨ |
| `& &&` | `&` | å·¦å€¼å¼•ç”¨ |
| `&& &&` | `&&` | å³å€¼å¼•ç”¨ |

**æ€»ç»“**ï¼šåªè¦æœ‰ä¸€ä¸ªæ˜¯å·¦å€¼å¼•ç”¨ï¼Œç»“æœå°±æ˜¯å·¦å€¼å¼•ç”¨ï¼›åªæœ‰ä¸¤ä¸ªéƒ½æ˜¯å³å€¼å¼•ç”¨ï¼Œç»“æœæ‰æ˜¯å³å€¼å¼•ç”¨ã€‚

### ç¤ºä¾‹

```cpp
typedef int& T1;
typedef int&& T2;

T1& a;   // int&  â†’ &
T1&& b;  // int&  â†’ &
T2& c;   // int&  â†’ &
T2&& d;  // int&& â†’ &&
```

### é‡è¦ï¼šå³å€¼å¼•ç”¨ä½œä¸ºè¡¨è¾¾å¼

```cpp
// å³å€¼å¼•ç”¨ç±»å‹åšè¡¨è¾¾å¼æ—¶ â†’ å·¦å€¼
template <typename T>
void fun(T &&x) {
    // x æœ¬èº«æ˜¯å·¦å€¼ï¼ˆæœ‰åå­—ï¼‰
    // std::is_lvalue_reference_v<decltype(x)> == true
}
```

---

## std::forward å®Œç¾è½¬å‘

### ç›®çš„

åœ¨æ¨¡æ¿å‡½æ•°ä¸­ï¼Œå°†æ¥æ”¶åˆ°çš„å‚æ•°ä»¥å…¶åŸæœ‰çš„å€¼ç±»åˆ«ï¼ˆå·¦å€¼ã€å³å€¼ï¼‰ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚

### é‡è½½å‡½æ•°ç¤ºä¾‹

```cpp
void process(int &x) {
    std::cout << "(int&)" << std::endl;
}

void process(int &&x) {
    std::cout << "(int&&)" << std::endl;
}

// é”™è¯¯çš„è½¬å‘
template <typename T>
void wrapper_bad(T &&x) {
    process(x);  // x æ€»æ˜¯å·¦å€¼ï¼ˆæœ‰åå­—ï¼‰ï¼Œæ€»æ˜¯è°ƒç”¨ process(int&)
}

// æ­£ç¡®çš„è½¬å‘
template <typename T>
void wrapper_good(T &&x) {
    process(std::forward<T>(x));  // ä¿æŒåŸæœ‰çš„å€¼ç±»åˆ«
}

// ä½¿ç”¨
int a = 10;
wrapper_good(a);              // è°ƒç”¨ process(int&)
wrapper_good(std::move(a));   // è°ƒç”¨ process(int&&)
```

### å®Œæ•´ç¤ºä¾‹

```cpp
template <typename T>
void display_type(T &&param) {
    std::cout << "T is lv reference: " << std::is_lvalue_reference_v<T> << std::endl;
    std::cout << "param is lvalue reference: " << std::is_lvalue_reference_v<decltype(param)> << std::endl;
    std::cout << "T traits normal type is int: " << std::is_integral_v<typename std::remove_reference_t<T>> << std::endl;
}
```

---

## ç±»å‹æ¨å¯¼è§„åˆ™

æ¨¡æ¿ç¼–ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨æ ¹æ®ä¼ å…¥çš„å®å‚è‡ªåŠ¨æ¨å¯¼æ¨¡æ¿å‚æ•°ç±»å‹ã€‚

### è§„åˆ™

1. **æ¨¡æ¿å‚æ•°ä¸å‡½æ•°å‚æ•°åŒ¹é…æ—¶**ï¼Œè‡ªåŠ¨æ¨å¯¼
2. **å¼•ç”¨çš„å¤„ç†**ï¼šå¼•ç”¨æŠ˜å 
3. **cv é™å®šç¬¦çš„å»é™¤**ï¼šconst ä¸ volatile ä¿®é¥°ä¼šå»é™¤

### ç§»é™¤å¼•ç”¨

```cpp
#include <type_traits>

template <typename T>
void remove_ref_example() {
    using Type = std::remove_reference_t<T>;
    // Type æ˜¯ T å»é™¤å¼•ç”¨åçš„ç±»å‹
}

// ç¤ºä¾‹
// std::remove_reference_t<int&>    â†’ int
// std::remove_reference_t<int&&>   â†’ int
// std::remove_reference_t<int>     â†’ int
```

---

## åŸæ ·è½¬å‘

### ç›®çš„

åœ¨æ¨¡æ¿å‡½æ•°ä¸­ï¼Œå°†æ¥æ”¶åˆ°çš„å‚æ•°ä»¥å…¶åŸæœ‰çš„å€¼ç±»åˆ«ï¼ˆå·¦å€¼ã€å³å€¼ï¼‰ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œç¡®ä¿æ³›å‹ä»£ç å¯ä»¥æ­£ç¡®å¤„ç†å‚æ•°ã€‚

### è¦ç‚¹

1. **ä¿æŒå‚æ•°å€¼ç±»åˆ«ä¸å˜**ï¼Œç¡®ä¿æ­£ç¡®è°ƒç”¨å‡½æ•°é‡è½½
2. **åˆ©ç”¨ç§»åŠ¨è¯­ä¹‰**ï¼Œé¿å…ä¸å¿…è¦çš„æ‹·è´ï¼Œæå‡æ€§èƒ½
3. **ç¼–å†™é€šç”¨ã€å¤ç”¨æ€§å¼ºçš„ä»£ç **

### å®ç°

é€šè¿‡ **æ¨¡æ¿ä¸‡èƒ½å¼•ç”¨** + **std::forward\<T>()**

### ç¤ºä¾‹å¯¹æ¯”

#### ç‰ˆæœ¬1ï¼šå€¼ä¼ é€’ï¼ˆä¸¢å¤±å¼•ç”¨ï¼‰

```cpp
template <typename F, typename T1, typename T2>
void flip1(F f, T1 t1, T2 t2) {
    f(t2, t1);  // t1, t2 æ˜¯æ‹·è´ï¼Œä¸¢å¤±å¼•ç”¨
}

void ftemp(int v1, int &v2) {
    std::cout << v1 << ' ' << ++v2 << std::endl;
}

void use_ftemp1() {
    int i = 100, j = 99;
    flip1(ftemp, j, 42);
    std::cout << j << std::endl;  // j ä»ç„¶æ˜¯ 99ï¼Œæ²¡æœ‰è¢«ä¿®æ”¹
}
```

#### ç‰ˆæœ¬2ï¼šä¸‡èƒ½å¼•ç”¨ï¼ˆä¿ç•™å¼•ç”¨ï¼‰

```cpp
template <typename F, typename T1, typename T2>
void flip2(F f, T1 &&t1, T2 &&t2) {
    f(t2, t1);  // t1, t2 ä¿æŒåŸæœ‰å¼•ç”¨
}

void use_ftemp2() {
    int i = 100, j = 99;
    flip2(ftemp, j, 42);
    std::cout << j << std::endl;  // j è¢«ä¿®æ”¹ä¸º 100
}
```

#### ç‰ˆæœ¬3ï¼šå®Œç¾è½¬å‘ï¼ˆå¤„ç†å³å€¼ï¼‰

```cpp
void gtemp(int &&i, int &j) {
    std::cout << i << ' ' << ++j << std::endl;
}

void use_ftemp3() {
    int i = 100, j = 99;
    flip2(gtemp, i, j);  // éœ€è¦å®Œç¾è½¬å‘æ‰èƒ½æ­£ç¡®å¤„ç†å³å€¼
    std::cout << j << std::endl;
}
```

---

## æ€»ç»“

### å€¼ç±»åˆ«æ€»ç»“

```
è¡¨è¾¾å¼
  â”œâ”€â”€ å·¦å€¼ (lvalue)
  â”‚   â””â”€â”€ æœ‰åå­—ã€æœ‰æŒä¹…å­˜å‚¨
  â”‚       å˜é‡ã€è§£å¼•ç”¨ã€*ptr
  â”‚
  â””â”€â”€ å³å€¼ (rvalue)
      â”œâ”€â”€ çº¯å³å€¼ (prvalue)
      â”‚   â””â”€â”€ ä¸´æ—¶å¯¹è±¡ã€å­—é¢é‡
      â”‚       10, 3.14, "hello"
      â”‚
      â””â”€â”€ å°†äº¡å€¼ (xvalue)
          â””â”€â”€ std::move() çš„ç»“æœ
```

### å¼•ç”¨ç±»å‹

| å¼•ç”¨ç±»å‹ | å£°æ˜ | ç»‘å®šå¯¹è±¡ |
|:---|:---:|:---|
| å·¦å€¼å¼•ç”¨ | `T&` | å·¦å€¼ |
| å³å€¼å¼•ç”¨ | `T&&` | å³å€¼ |
| ä¸‡èƒ½å¼•ç”¨ | `T&&` (T æ˜¯æ¨¡æ¿å‚æ•°) | å·¦å€¼æˆ–å³å€¼ |

### å®Œç¾è½¬å‘ä¸‰è¦ç´ 

1. **æ¨¡æ¿å‚æ•° T**ï¼šç”¨äºæ¨å¯¼åŸå§‹ç±»å‹
2. **ä¸‡èƒ½å¼•ç”¨ T&&**ï¼šæ¥æ”¶ä»»æ„å€¼ç±»åˆ«
3. **std::forward\<T>()**ï¼šä¿æŒåŸå§‹å€¼ç±»åˆ«è½¬å‘

```cpp
template <typename T>
void perfect_forward(T &&arg) {
    other_function(std::forward<T>(arg));
}
```

---

> æ•´ç†è€…ï¼šè•¾å§† ğŸ’™
